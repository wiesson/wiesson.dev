---
import BlogCard from "$components/blog/blog-card.astro";
import ResponsiveCardList from "$components/layout/responsive-card-list.svelte";
import type { CollectionEntry } from "astro:content";

interface Props {
  posts: CollectionEntry<"blog">[];
  title?: string;
}

const { posts, title = "Blog" } = Astro.props;

// Extract date from file path if not in frontmatter
const getDateFromFilePath = (filePath: string): Date | undefined => {
  const match = filePath.match(/(\d{4}-\d{2}-\d{2})/);
  return match ? new Date(match[1]) : undefined;
};

// Filter out drafts and sort by date (newest first)
const sortedPosts = [...posts]
  .filter((post) => !post.data.draft)
  .sort((a, b) => {
    const dateA =
      a.data.publishedAt || getDateFromFilePath(a.filePath || "") || new Date(0);
    const dateB =
      b.data.publishedAt || getDateFromFilePath(b.filePath || "") || new Date(0);
    return dateB.getTime() - dateA.getTime();
  });
---

<section class="app-grid scroll-mt-16">
  <div class="app-text-column mb-4">
    <h2 class="title">{title}</h2>
  </div>
  <div class="app-full-column">
    <ResponsiveCardList client:idle>
      {sortedPosts.slice(0, 3).map((post) => (
        <BlogCard
          title={post.data.title}
          description={post.data.description}
          image={post.data.image}
          href={`/blog/${post.id}`}
          date={post.data.publishedAt || getDateFromFilePath(post.filePath || "")}
          tags={post.data.tags}
        />
      ))}
    </ResponsiveCardList>
  </div>
</section>
