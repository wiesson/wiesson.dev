---
import "../styles/base.css";
import CvHeader from "@/components/cv-header";
import CvWorkListing from "@/components/cv-work-listing";
import AboutSection from "@/components/about-section.astro";
import TechnologiesSection from "@/components/technologies-section.astro";
import ProjectsSection from "@/components/projects-section.astro";
import SiteFooter from "@/components/site-footer";
import { getCollection } from "astro:content";

const isProd = import.meta.env.PROD;

// Get work experience
const cvWork = await getCollection("work");

// Sort by end date (most recent first)
cvWork.sort((a, b) => {
  const aIsNow = a.data.to === "now";
  const bIsNow = b.data.to === "now";

  if (aIsNow && !bIsNow) return -1;
  if (!aIsNow && bIsNow) return 1;
  if (aIsNow && bIsNow) {
    return new Date(b.data.from).valueOf() - new Date(a.data.from).valueOf();
  }

  const dateATo = new Date(a.data.to);
  const dateBTo = new Date(b.data.to);

  if (dateBTo.valueOf() !== dateATo.valueOf()) {
    return dateBTo.valueOf() - dateATo.valueOf();
  }

  return new Date(b.data.from).valueOf() - new Date(a.data.from).valueOf();
});
---

<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>
      Arne Wiese | Senior Full-Stack Engineer · AI/LLM-Integration · TypeScript,
      React, Svelte
    </title>
    <meta
      name="description"
      content="Senior Engineer für MVPs, die langfristig skalieren. 10+ Jahre Erfahrung in E-Commerce, Telco & IoT. Spezialisiert auf AI-Integration, moderne Web-Architekturen und nachhaltige Codebases."
    />
  </head>
  <body>
    <!-- Main Content -->
    <main>
      <!-- CV Header with Profile -->
      <CvHeader
        name="Arne Wiese"
        title="Senior AI Software Engineer"
        location="Meerbusch, Germany"
        imageUrl="/assets/arne-neu-quadratisch.jpeg"
      />

      <!-- About Section -->
      <AboutSection />

      <CvWorkListing
        title="Projekte & Festanstellungen"
        items={cvWork.filter((item) => item.data.type === "main")}
        showIntro={true}
        showDetails={false}
        showYearsOnly={true}
        showBadges={false}
      />

      <CvWorkListing
        title="Nebenprojekte"
        items={cvWork.filter((item) => item.data.type === "side")}
        showIntro={true}
        showDetails={false}
        showYearsOnly={true}
        showBadges={false}
      />

      <!-- Technologies & Skills -->
      <TechnologiesSection />

      <!-- Projects -->
      <ProjectsSection />
    </main>

    <!-- Footer -->
    <SiteFooter />

    {isProd && <script data-domain="arnewiese.de" src="/js/script.js" />}
  </body>
</html>
