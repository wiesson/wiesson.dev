---
import BaseLayout from "@/layouts/BaseLayout.astro";
import AboutSection from "@/components/about-section.astro";
import CvWorkListing from "@/components/cv-work-listing";
import { getCollection } from "astro:content";
import ProjectsSection from "@/components/projects-section.astro";
import ServicesSection from "@/components/services-section.astro";
import TechnologiesSection from "@/components/technologies-section.astro";

const cvWork = await getCollection("work");

const now = new Date();

cvWork.sort((a, b) => {
  const toA = a.data.to === "now" ? now : a.data.to;
  const toB = b.data.to === "now" ? now : b.data.to;

  const dateAFrom = toA.getTime();
  const dateBFrom = toB.getTime();

  return dateBFrom - dateAFrom;
});
---

<BaseLayout>
  <AboutSection />

  <CvWorkListing
    title="Projekte & Festanstellungen"
    items={cvWork.filter((item) => item.data.type === "main")}
    showIntro
    showBadges={false}
    showYearsOnly={true}
  />

  <CvWorkListing
    title="Nebenprojekte"
    items={cvWork.filter((item) => item.data.type === "side")}
    showIntro
    showBadges={false}
    showYearsOnly={true}
  />

  <TechnologiesSection />
  <ProjectsSection />
</BaseLayout>
