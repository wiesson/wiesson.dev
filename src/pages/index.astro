---
import BaseLayout from "$layouts/base-layout.astro";
import AboutSection from "$components/sections/about-section.astro";
import ServicesSection from "$components/sections/services-section.astro";
import FeaturedProjectsSection from "$components/sections/featured-projects-section.astro";
import CvWorkListing from "$components/cv/cv-work-listing.svelte";
import { getCollection } from "astro:content";
import ProjectsSection from "$components/sections/projects-section.astro";
import TechnologiesSection from "$components/sections/technologies-section.astro";
// import BlogCarouselSection from "$components/sections/blog-carousel-section.astro";
import { getTranslations } from "../i18n";

const lang = "de";
const t = getTranslations(lang);
const cvWork = await getCollection("work");
// const blogPosts = await getCollection("blog");

const now = new Date();

cvWork.sort((a, b) => {
  const toA = a.data.to === "now" ? now : a.data.to;
  const toB = b.data.to === "now" ? now : b.data.to;

  const dateAFrom = toA.getTime();
  const dateBFrom = toB.getTime();

  return dateBFrom - dateAFrom;
});

// Limit to 5 most recent main projects for frontpage
const recentMainWork = cvWork
  .filter((item) => item.data.type === "main")
  .slice(0, 5);

const totalProjects = cvWork.filter((item) => item.data.type === "main").length;
const startYear =
  cvWork.length > 0
    ? new Date(
        Math.min(...cvWork.map((w) => new Date(w.data.from).getTime()))
      ).getFullYear()
    : new Date().getFullYear();
---

<BaseLayout lang={lang}>
  <AboutSection lang={lang} />

  <ServicesSection lang={lang} />

  <FeaturedProjectsSection lang={lang} />

  <!-- Blog section hidden for now -->
  <!-- <BlogCarouselSection posts={blogPosts} title="Blog" /> -->

  <CvWorkListing
    title={t.sections.workExperience}
    subtitle={t.sections.workExperienceSubtitle
      .replace("{count}", totalProjects.toString())
      .replace("{year}", startYear.toString())}
    items={recentMainWork}
    lang={lang}
    showIntro
    showBadges={false}
    showYearsOnly={true}
    viewAllLink={{
      href: "/cv",
      label: t.sections.viewAllProjects,
    }}
  />

  <TechnologiesSection lang={lang} />
  <ProjectsSection lang={lang} />
</BaseLayout>
